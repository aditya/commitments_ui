<script type="text/ng-template" id="subitem.html">
            <div>
                <table class="task-core">
                    <tr>
                        <td class="task-action" animated-visible="hover || sorting">
                            <div handle class="icon-reorder" tooltip="'Drag to reorder'" >
                            </div>
                        </td>
                        <td class="task-check">
                            <span check ng-model="item.done" tooltip="'Mark done'"></span>
                        </td>
                        <td class="task-what">
                            <span search-highlight="searchQuery" markdown focus-on="item.id" placeholder="'New subtask here'" ng-model="item.what" class="larger"></span>
                        </td>
                        <td class="task-action" animated-visible="hover && !sorting">
                            <span action="deleterecord" tooltip="'Delete this sub item'"><i class="icon-trash"></i></span>
                        </td>
                    </tr>
                </table>
            </div>
            <ol class="tasks-subtasks">
            <li ng-repeat="item in item.subitems" editable-record ng-model="item" ng-include="'subitem.html'" class="task-subtask">
            </li>
            </ol>
</script>

<ol
    ng-controller="Tasks"
    editable-list
    editable-list-reorder
    sort-update="sorted"
    on-delete="delete"
    on-update="update"
    ng-model="selected.items"
    class="tasks">
    <li class="alert" ng-show="selected.itemCount() == 0">
    No Items
    </li>
    <!--repeat items-->
    <li ng-repeat="item in database.items"
    editable-record
    ng-model="item"
    animated-hide="selected.hide(item)"
    class="task">
    <div ng-controller="Task" class="task-content">
        <div handle class="icon-reorder"
            tooltip="'Drag to reorder'"
            animated-visible="hover || sorting">
        </div>
        <div class="task-accept">
            <div ng-include src="'src/views/taskaccept.html'"></div>
        </div>
        <!-- this is the main visible todo -->
        <table class="task-core">
            <tr>
                <td class="task-check">
                    <span check ng-model="item.done" tooltip="'Mark done'"></span>
                </td>
                <td class="task-action" animated-visible="hover && !sorting">
                    <span action ng-click="subitem(item)" tooltip="'Add a sub-task'"><i class="icon-level-down"></i></span>
                </td>
                <td class="task-what">
                    <div search-highlight="searchQuery" markdown ng-model="item.what" class="larger">
                        <span ng-show="focused" ng-include src="'src/views/taskhelp.html'"></span>
                    </div>
                </td>
                <td class="task-action" animated-visible="hover && !sorting">
                    <span action ng-hide="item.done" ng-click="delete(item)" tooltip="'Straight to the trash!'"><i class="icon-trash"></i></span>
                    <span action="archiveitem" ng-hide="!item.done" tooltip="'Archive old items'"><i class="icon-download-alt"></i></span>
                </td>
            </tr>
        </table>
        <ol animated-show="focused || true"
            editable-list
            editable-list-reorder
            nested
            sort-update="sorted"
            ng-model="item.subitems" class="tasks-subtasks">
            <li ng-repeat="item in item.subitems" editable-record ng-model="item" ng-include="'subitem.html'" class="task-subtask">
            </li>
        </ol>
        <!--this div is to control visibility so that extended items are show on demand-->
        <div animated-show="focused && item.what && extended" class="task-extended">
            <ul requires-object="extended.discussion" class="task-tools">
                <li ng-hide="true" action ng-click="poke(extended)"><i class="icon-hand-right"></i></li>
                <li tags tags-query="tags" icon="tags" ng-model="extended.tags"></li>
                <li tags tags-query="links" item-icon-from="gravatar" icon="user" ng-model="extended.links"></li>
                <li>
                <ul class="task-accept">
                    <li class="info-icon icon-ok-sign"></li>
                    <li ng-repeat="(email, _) in item.accept">
                    <span gravatar ng-model="email"></span>
                    </li>
                </ul>
                </li>
                <li>
                <ul class="task-reject">
                    <li class="info-icon icon-remove-sign"></li>
                    <li ng-repeat="(email, _) in item.reject">
                    <span gravatar ng-model="email"></span>
                    </li>
                </ul>
                </li>
            </ul>
            <div class="task-discussion">
                <div ng-include src="'src/views/discussion.html'"></div>
            </div>
            <hr/>
            <div class="task-footer">Last Updated:
                <span username ng-model="extended.lastUpdatedBy"></span>
                <span postdate ng-model="extended.lastUpdatedAt"></span>
            </div>
        </div>
    </div>
    </li>
    <!--the new record placeholder-->
    <li
    editable-record
    editable-record-placeholder="placeholderItem"
    ng-model="$$placeholder" ng-show="selected.allowNew" class="task">
    <div class="task-core">
        <span focus-on="'newtask'" markdown ng-model="$$placeholder.what" placeholder="'New task here'" class="task-placeholder larger">
            <span ng-show="focused" ng-include src="'src/views/taskhelp.html'"></span>
        </span>
    </div>
    </li>
</ol>
